# NVCCFLAGS     := -O3
# CUDA_PATH     := /usr/local/cuda
# CUDA_INC_PATH := $(CUDA_PATH)/include
# CUDA_LIB_PATH := $(CUDA_PATH)/lib64
# INCLUDES      := -I$(CUDA_INC_PATH) -I.
# LDFLAGS       := -L$(CUDA_LIB_PATH) -lcuda

# ifeq ($(shell hostname), santacruz)
# 	GENCODE_FLAGS   := -gencode arch=compute_80,code=sm_80
# else
# 	GENCODE_FLAGS   := -gencode arch=compute_80,code=sm_80
# endif

# gcm_kernels.cubin: gcm_kernels.cu
# 	nvcc $(NVCCFLAGS) --cubin $(GENCODE_FLAGS) $(INCLUDES) -o $@ $+ $(LDFLAGS)

# .PHONY: gcm_kernels.cubin

HIP_PATH ?= $(shell \
	if [ -n "$$HIP_PATH" ]; then \
		echo "$$HIP_PATH"; \
	elif command -v hipcc >/dev/null 2>&1; then \
		dirname $$(dirname $$(readlink -f $$(command -v hipcc))); \
	elif [ -d "/opt/rocm" ]; then \
		ls -d /opt/rocm* 2>/dev/null | head -1; \
	else \
		echo "/opt/rocm"; \
	fi)
HIP_INCLUDE = -I$(HIP_PATH)/include -I$(HIP_PATH)/hip/include
HIP_FLAGS = -D__HIP_PLATFORM_AMD__ -x hip -std=c++17 -fPIC

gcm_kernels.hsaco: gcm_kernels.cpp
	hipcc $(HIP_INCLUDE) $(HIP_FLAGS) -O3 --genco -o $@ $+

.PHONY: gcm_kernels.hsaco